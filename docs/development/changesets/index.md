# Changesets ä½¿ç”¨æŒ‡å—

## ğŸ“– æ¦‚è¿°

Changesets æ˜¯ä¸“ä¸º Monorepo è®¾è®¡çš„ç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒå·¥å…·ï¼Œç”¨äºï¼š
- è‡ªåŠ¨ç®¡ç†ç‰ˆæœ¬å·ï¼ˆéµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬ SemVerï¼‰
- è‡ªåŠ¨å¤„ç†ä¾èµ–é¡ºåºå’Œç‰ˆæœ¬æ›´æ–°
- è‡ªåŠ¨ç”Ÿæˆå˜æ›´æ—¥å¿—ï¼ˆCHANGELOG.mdï¼‰
- ç®€åŒ–å‘å¸ƒæµç¨‹

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºå˜æ›´é›†ï¼ˆChangesetï¼‰

åœ¨ä»£ç ä¿®æ”¹åï¼Œåˆ›å»ºå˜æ›´é›†æ–‡ä»¶æ¥è®°å½•å˜æ›´ï¼š

```bash
pnpm changeset
```

æˆ–è€…ä½¿ç”¨ï¼š

```bash
nr changeset
```

äº¤äº’å¼é€‰æ‹©ï¼š
- **å—å½±å“çš„åŒ…**ï¼šé€‰æ‹© coreã€formã€kit ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ª
- **å˜æ›´ç±»å‹**ï¼š
  - `patch`ï¼šBug ä¿®å¤ã€æ€§èƒ½ä¼˜åŒ–ï¼ˆ0.1.2 â†’ 0.1.3ï¼‰
  - `minor`ï¼šæ–°åŠŸèƒ½ã€å‘ä¸‹å…¼å®¹çš„å¢å¼ºï¼ˆ0.1.2 â†’ 0.2.0ï¼‰
  - `major`ï¼šç ´åæ€§å˜æ›´ã€ä¸å…¼å®¹çš„ API ä¿®æ”¹ï¼ˆ0.1.2 â†’ 1.0.0ï¼‰
- **å˜æ›´æè¿°**ï¼šç®€è¦æè¿°æœ¬æ¬¡å˜æ›´

### 2. æäº¤å˜æ›´é›†æ–‡ä»¶

åˆ›å»ºå˜æ›´é›†åï¼Œæäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼š

```bash
git add .changeset/
git commit -m "chore: add changeset"
git push
```

### 3. æ›´æ–°ç‰ˆæœ¬å·

åˆå¹¶åˆ° main åˆ†æ”¯åï¼Œæ ¹æ®å˜æ›´é›†æ›´æ–°ç‰ˆæœ¬å·ï¼š

```bash
pnpm version
```

æˆ–è€…ï¼š

```bash
nr version
```

è¿™ä¸ªå‘½ä»¤ä¼šï¼š
- è‡ªåŠ¨æ£€æŸ¥åˆ†æ”¯ï¼ˆé€šè¿‡ Changesets pre é’©å­ï¼Œå¿…é¡»åœ¨ main æˆ– master åˆ†æ”¯ï¼‰
- è¯»å– `.changeset/` ç›®å½•ä¸‹çš„å˜æ›´é›†æ–‡ä»¶
- è‡ªåŠ¨æ›´æ–°åŒ…çš„ç‰ˆæœ¬å·ï¼ˆæ ¹æ®å˜æ›´ç±»å‹ï¼‰
- è‡ªåŠ¨æ›´æ–°å†…éƒ¨ä¾èµ–ç‰ˆæœ¬ï¼ˆå¦‚æœè¢«ä¾èµ–åŒ…ç‰ˆæœ¬å˜åŒ–ï¼‰
- ç”Ÿæˆæˆ–æ›´æ–° CHANGELOG.md
- åˆ é™¤å·²å¤„ç†çš„å˜æ›´é›†æ–‡ä»¶

**æ³¨æ„**ï¼šåˆ†æ”¯æ£€æŸ¥å·²é›†æˆåˆ° Changesets çš„ pre é’©å­ä¸­ï¼Œæ— éœ€æ‰‹åŠ¨æ£€æŸ¥ã€‚

### 4. æäº¤ç‰ˆæœ¬æ›´æ–°

ç‰ˆæœ¬æ›´æ–°åï¼Œæäº¤æ›´æ”¹ï¼š

```bash
git add .
git commit -m "chore: version packages"
git push
```

### 5. å‘å¸ƒåŒ…

å‘å¸ƒæ‰€æœ‰éœ€è¦å‘å¸ƒçš„åŒ…ï¼š

```bash
pnpm release
```

æˆ–è€…ï¼š

```bash
nr release
```

è¿™ä¸ªå‘½ä»¤ä¼šï¼š
- è‡ªåŠ¨æ£€æŸ¥åˆ†æ”¯ï¼ˆé€šè¿‡ Changesets pre é’©å­ï¼Œå¿…é¡»åœ¨ main æˆ– master åˆ†æ”¯ï¼‰
- æŒ‰ä¾èµ–é¡ºåºå‘å¸ƒåˆ° npmï¼ˆcore â†’ form â†’ kitï¼‰
- æ¯ä¸ªåŒ…çš„ `prepublishOnly` é’©å­ä¼šè‡ªåŠ¨æ‰§è¡Œæ„å»ºå’Œç±»å‹æ£€æŸ¥
- è‡ªåŠ¨å¤„ç†å†…éƒ¨ä¾èµ–ç‰ˆæœ¬æ›´æ–°

**æ³¨æ„**ï¼š
- åˆ†æ”¯æ£€æŸ¥å·²é›†æˆåˆ° Changesets çš„ pre é’©å­ä¸­ï¼Œæ— éœ€æ‰‹åŠ¨æ£€æŸ¥
- æ„å»ºç”±æ¯ä¸ªåŒ…çš„ `prepublishOnly` é’©å­è‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€åœ¨ `release` å‘½ä»¤ä¸­æ‰‹åŠ¨æ„å»º

## ğŸ“ å®Œæ•´å‘å¸ƒæµç¨‹ç¤ºä¾‹

```bash
# 1. å¼€å‘å®Œæˆåï¼Œåˆ›å»ºå˜æ›´é›†
pnpm changeset
# äº¤äº’å¼é€‰æ‹©ï¼šé€‰æ‹©åŒ…ã€å˜æ›´ç±»å‹ã€è¾“å…¥æè¿°

# 2. æäº¤å˜æ›´é›†æ–‡ä»¶
git add .changeset/
git commit -m "chore: add changeset"
git push

# 3. åˆå¹¶åˆ° main åˆ†æ”¯åï¼Œæ›´æ–°ç‰ˆæœ¬å·
pnpm version
# è¿™ä¼šæ›´æ–°ç‰ˆæœ¬å·ã€ä¾èµ–ç‰ˆæœ¬å’Œ CHANGELOG

# 4. æäº¤ç‰ˆæœ¬æ›´æ–°
git add .
git commit -m "chore: version packages"
git push

# 5. å‘å¸ƒåŒ…
pnpm release
# è¿™ä¼šå‘å¸ƒæ‰€æœ‰éœ€è¦å‘å¸ƒçš„åŒ…åˆ° npm
```

## âš™ï¸ é…ç½®è¯´æ˜

é…ç½®æ–‡ä»¶ï¼š`.changeset/config.json`

```json
{
  "access": "public",                    // åŒ…å‘å¸ƒä¸ºå…¬å¼€åŒ…
  "baseBranch": "main",                  // åŸºç¡€åˆ†æ”¯
  "updateInternalDependencies": "patch", // å†…éƒ¨ä¾èµ–æ›´æ–°ç­–ç•¥
  "commit": false                        // ä¸è‡ªåŠ¨æäº¤ï¼ˆæ‰‹åŠ¨æ§åˆ¶ï¼‰
}
```

## âœ¨ Changesets çš„ä¼˜åŠ¿

1. **è‡ªåŠ¨åŒ–ä¾èµ–é¡ºåº**ï¼šè‡ªåŠ¨æŒ‰ä¾èµ–é¡ºåºå‘å¸ƒï¼ˆcore â†’ form â†’ kitï¼‰
2. **è‡ªåŠ¨ç‰ˆæœ¬æ›´æ–°**ï¼šæ ¹æ®å˜æ›´ç±»å‹è‡ªåŠ¨æ›´æ–°ç‰ˆæœ¬å·
3. **è‡ªåŠ¨ä¾èµ–æ›´æ–°**ï¼šè‡ªåŠ¨æ›´æ–°å†…éƒ¨ä¾èµ–ç‰ˆæœ¬
4. **è‡ªåŠ¨å˜æ›´æ—¥å¿—**ï¼šè‡ªåŠ¨ç”Ÿæˆ CHANGELOG.md
5. **å˜æ›´å®¡æŸ¥**ï¼šå˜æ›´é›†æ–‡ä»¶å¯ä»¥æäº¤ PR å®¡æŸ¥
6. **é¿å…é”™è¯¯**ï¼šä¸ä¼šå› ä¸ºå·¥ä½œåŒºä¸å¹²å‡€è€Œå¤±è´¥

## ğŸ“š æ›´å¤šèµ„æº

- [Changesets å®˜æ–¹æ–‡æ¡£](https://github.com/changesets/changesets)
- [å¸¸è§é—®é¢˜](https://github.com/changesets/changesets/blob/main/docs/common-questions.md)
- [Changesets é…ç½®è¯´æ˜](./config.md)
- [é¡¹ç›®è§„èŒƒ](../../../.cursor/rules/001_monorepo_development-standards.mdc)
