---
description: 开发工具配置规范
globs: 
alwaysApply: true
priority: 2
tags:
  - tool-config
  - development
---

# 开发工具配置规范

> **⚠️ 强制要求 - 请勿忽略**
>
> 本文档定义了开发工具配置、工具使用、安全和兼容性规范。

## 开发工具配置

### Node.js 版本管理规范

- 优先使用 Volta 管理 Node.js 版本：Volta 必须全局安装，使用前检查是否已安装，优先检查项目中是否已存在 Volta 配置并遵循现有配置（必须使用 `read_file` 工具逐行逐字符读取 `package.json` 文件）
- 备选方案：若 Volta 不可用，使用项目 `package.json` 中的 `engines` 字段或 `.nvmrc` 文件管理 Node.js 版本（必须使用 `read_file` 工具逐行逐字符读取相关配置文件）

### 包管理器规范

- 优先使用 @antfu/ni 智能命令：`@antfu/ni` 必须全局安装，使用前检查是否已安装，使用 `ni` 安装依赖，使用 `nr` 运行脚本命令
- 备选方案：若 ni 不可用，使用 npm 作为备选包管理器
- 执行包管理命令前，优先检查项目根目录的锁文件类型，使用对应的包管理器（必须使用 `read_file` 工具逐行逐字符读取锁文件或使用 `list_dir` 工具检查文件存在性）

## 工具使用规范

- 配置文件查询规范（执行前必查）：
  - 必须读取最新内容：必须使用 `read_file` 工具逐行逐字符读取最新的配置文件内容，禁止使用缓存的配置内容
  - 禁止缓存：每次执行前必须重新逐行逐字符读取配置文件，确保使用最新的配置信息
  - 读取时机：脚本执行前逐行逐字符读取 `package.json` 的 `scripts` 字段，依赖操作前逐行逐字符读取 `dependencies`、`devDependencies`、`peerDependencies`、`engines`、`volta` 字段，构建配置前逐行逐字符读取相关配置文件，环境配置前逐行逐字符读取 `.env.example`、`.env` 或 `.env.local`，工具配置前逐行逐字符读取 `.editorconfig`、`.gitignore`、`.npmrc` 或 `.pnpmrc`
- 脚本执行规范：
  - 必须读取最新内容：执行脚本前必须先使用 `read_file` 工具逐行逐字符读取 `package.json` 的 `scripts` 字段，禁止使用缓存的脚本信息
  - 环境检测：检测当前运行环境并根据环境生成对应的命令
  - 命令选择：运行脚本时优先使用 `@antfu/ni` 提供的 `nr` 命令，若 `nr` 不可用，根据项目锁文件类型使用对应的包管理器命令
- 配置修改：
  - 必须读取最新内容：修改配置前，必须先使用 `read_file` 工具逐行逐字符读取相关配置文件的最新内容，禁止使用缓存的配置内容
  - 理解现有配置：逐行逐字符理解现有配置后再进行修改
  - 测试验证：修改后测试确保配置生效

## 安全规范

- 不在代码中硬编码敏感信息，使用环境变量管理敏感信息，确保 `.gitignore` 正确配置
- 定期检查依赖的安全漏洞，使用 `pnpm audit` 或类似工具检查，及时更新有安全漏洞的依赖

## 兼容性规范

- 明确项目支持的浏览器版本，使用 Babel 或类似工具处理兼容性，测试主要浏览器的兼容性
- 明确项目的 Node.js 版本要求和包管理器版本要求，在文档中明确说明版本要求
