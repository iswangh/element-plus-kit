---
description: AI 行动执行规范
globs: 
alwaysApply: true
priority: 1  # 最高优先级，确保规则被优先执行
tags:
  - mandatory  # 标记为强制要求
  - critical   # 标记为关键要求
  - ai-execution  # 标记为 AI 执行相关
---

# AI 行动执行规范

> **⚠️ 强制要求 - 请勿忽略**
>
> 本文档定义了 AI 在执行任务时的标准流程和规范，AI 必须严格遵循，不得违反或忽略。

## 执行检查清单

在执行任何任务前，必须执行以下检查：

1. 重新读取所有最新的规则文件（使用 `read_file` 工具，按编号顺序读取）
2. 在回答内容的最开始声明将严格遵循的规则文件列表（使用 `@` 符号引用）
3. 检查任务是否符合规则文件的所有要求
4. 评估任务的复杂度和影响范围

## 目录导航

- [功能评估规范](#强制要求功能评估规范)
- [步骤拆分规范](#强制要求步骤拆分规范)
- [执行记录规范](#强制要求执行记录规范)
- [复查规范](#强制要求复查规范)

## 强制要求：功能评估规范

### 评估时机

- 接收任务后，必须先对功能进行评估
- 评估必须在执行任何代码修改之前完成
- 评估结果必须记录在 `ai-generated/logs/` 目录下的执行日志中

### 评估内容

- **功能复杂度**：评估功能的复杂程度，包括涉及的模块、组件、依赖关系等
- **技术可行性**：评估技术实现的可行性，包括技术栈、依赖库、兼容性等
- **影响范围**：评估功能变更对现有代码的影响范围，包括可能影响的文件、模块、功能等
- **依赖关系**：评估功能实现所需的依赖关系，包括内部依赖、外部依赖、构建依赖等

### 实现方案评估

- **方案查询**：评估时，必须查询多个实现方案，考虑不同的技术路径和实现方式
- **方案对比**：列出最多三个方案并对比，使用表格展示，排序顺序从最推荐的方案开始
- **对比维度**：包括实现难度、性能影响、可维护性、兼容性、扩展性等维度
- **方案选择**：根据项目实际情况和需求，选择最适合的实现方案

### 评估结果记录

- 评估结果必须记录在 `ai-generated/logs/` 目录下的执行日志中
- 记录内容包括：任务描述、功能复杂度评估、技术可行性分析、影响范围分析、依赖关系分析、实现方案对比表格、推荐方案及理由

## 强制要求：步骤拆分规范

### 拆分原则

- 将复杂任务拆分为多个可执行的步骤
- 每个步骤应该独立、可验证
- 步骤之间应该有明确的依赖关系
- 步骤拆分应该遵循"先依赖后实现"的原则

### 步骤定义

- **步骤描述**：每个步骤必须有清晰的描述，说明要执行的具体操作
- **步骤目标**：每个步骤必须有明确的目标，说明完成后应该达到的状态
- **步骤依赖**：每个步骤必须明确依赖的前置步骤
- **步骤验证**：每个步骤必须有明确的验证方式，确保步骤执行成功

### 拆分结果记录

- 拆分结果必须记录在 `ai-generated/logs/` 目录下的执行日志中
- 记录内容包括：任务描述、步骤列表、每个步骤的描述、目标、依赖关系、验证方式

## 强制要求：执行记录规范

### 执行前查询

- 每个步骤执行前，必须查询文档中记录的上一个步骤是什么
- 查询结果必须输出给用户，让用户知道当前执行到哪里了
- 如果上一个步骤未完成，必须等待上一个步骤完成后再执行当前步骤

### 执行后查询

- 每个步骤执行完成后，必须查询下一步应该执行什么
- 查询结果必须输出给用户，让用户知道已经执行了什么、还有什么没有执行
- 如果下一步存在，必须明确告知下一步的执行内容

### 时间记录

- 每个步骤执行开始时，必须记录开始执行的时间
- 每个步骤执行完成后，必须记录完成的时间
- 时间记录必须使用系统命令获取当前系统时间（使用 `run_terminal_cmd` 工具）
- 时间格式：`YYYY-MM-DD HH:mm:ss 星期X`（详细要求请参考 000 规范中的"时间返回规范"章节）

### 执行日志记录

- 所有任务执行过程必须记录在 `ai-generated/logs/` 目录下
- 日志文件命名：使用任务描述和时间戳，格式为 `task-{任务描述}-{时间戳}.md`
- 记录内容包括：
  - 任务描述
  - 评估结果（功能复杂度、技术可行性、影响范围、依赖关系、实现方案对比）
  - 步骤拆分（步骤列表、每个步骤的描述、目标、依赖关系、验证方式）
  - 执行进度（当前步骤、已完成步骤、待执行步骤）
  - 每个步骤的执行记录（开始时间、完成时间、执行结果、遇到的问题）
  - 复查记录（每个步骤的复查结果、整体复查结果）

### 进度展示

- 执行过程中，必须向用户展示当前执行进度
- 进度展示内容包括：
  - 当前执行的步骤
  - 已完成的步骤列表
  - 待执行的步骤列表
  - 每个步骤的执行状态（待执行、执行中、已完成、已复查）

## 强制要求：复查规范

### 步骤复查

- 每个步骤执行完后，必须进行复查
- 复查内容包括：
  - 步骤是否按预期完成
  - 代码修改是否符合项目规范
  - 是否有潜在的问题或隐患
  - 是否需要调整后续步骤
- 复查结果必须记录在执行日志中，包括是否复查、复查时间、复查结果

### 整体复查

- 所有步骤执行完成后，必须进行整体的复查
- 整体复查内容包括：
  - **隐患检查**：检查是否还有潜在的问题或隐患，包括代码错误、性能问题、安全问题等
  - **功能完整性**：检查功能是否全部关联起来，是否满足需求，是否有遗漏的功能点
  - **规范符合性**：检查代码实现是否已经符合规则文件和项目规范，包括代码风格、命名规范、类型定义、注释规范等
  - **文档同步**：检查相关文档是否需要同步更新（参考 000 规范中的"文档同步机制"章节）
- 整体复查结果必须记录在执行日志中，包括复查时间、复查内容、发现的问题、修复建议

### 复查记录

- 所有复查记录必须记录在执行日志中
- 复查记录格式：
  - 步骤复查：`[步骤X] 复查时间：YYYY-MM-DD HH:mm:ss，复查结果：通过/未通过，问题描述：xxx`
  - 整体复查：`[整体复查] 复查时间：YYYY-MM-DD HH:mm:ss，隐患检查：通过/未通过，功能完整性：通过/未通过，规范符合性：通过/未通过，发现的问题：xxx，修复建议：xxx`

## 执行流程示例

### 任务接收

1. 接收用户任务
2. 查询并列出遵循的规则文件
3. 读取相关规则文件，理解任务要求

### 功能评估

1. 评估功能复杂度、技术可行性、影响范围、依赖关系
2. 查询多个实现方案，列出最多三个方案并对比（使用表格展示）
3. 选择推荐方案并说明理由
4. 记录评估结果到执行日志

### 步骤拆分

1. 将任务拆分为多个可执行的步骤
2. 定义每个步骤的描述、目标、依赖关系、验证方式
3. 记录拆分结果到执行日志

### 步骤执行

1. 查询上一个步骤（如果是第一个步骤，跳过）
2. 记录步骤开始时间
3. 执行步骤
4. 记录步骤完成时间
5. 进行步骤复查
6. 记录复查结果
7. 查询下一步骤
8. 向用户展示执行进度

### 整体复查

1. 所有步骤执行完成后，进行整体复查
2. 检查隐患、功能完整性、规范符合性、文档同步
3. 记录整体复查结果
4. 如有问题，提供修复建议

### 任务完成

1. 更新执行日志，标记任务完成
2. 向用户展示任务完成情况和整体复查结果
3. 如有需要，提供后续建议
