---
description: 工程化实践规范
globs: 
alwaysApply: true
priority: 2
tags:
  - engineering
  - development
---

# 工程化实践规范

> **⚠️ 强制要求 - 请勿忽略**
>
> 本文档定义了工程化实践规范，包括版本控制、版本管理、代码变更、文件管理、代码审查和依赖管理。

## 版本控制规范

- 遵循约定式提交（Conventional Commits）格式：`<type>(<scope>): <subject>`，提交类型：`feat`、`fix`、`docs`、`style`、`refactor`、`test`、`chore` 等，破坏性变更需使用 `BREAKING CHANGE:` 标记
- 遵循项目的分支策略，保持主分支（main/master）代码始终可运行，功能开发使用特性分支，合并前需进行代码审查

## 版本管理规范

### 版本格式规范

- 必须使用语义化版本（Semantic Versioning，SemVer）：版本格式 `MAJOR.MINOR.PATCH`（如 `1.2.3`），MAJOR 不兼容的 API 修改时递增，MINOR 向下兼容的功能性新增时递增，PATCH 向下兼容的问题修正时递增

### package.json 版本字段规范

- `package.json` 中的 `version` 字段必须符合语义化版本（SemVer）规范，使用字符串格式（如 `"1.0.0"`）
- 初始开发使用 `"0.0.0"`，预发布版本可使用预发布标识符（如 `"1.0.0-alpha.1"`、`"1.0.0-beta.1"`、`"1.0.0-rc.1"`），正式版本从 `"1.0.0"` 开始

### 版本更新策略

- 主版本号（MAJOR）：不兼容的 API 修改时递增（删除或重命名公共 API、改变默认行为或配置、移除已废弃的功能、重大架构变更）
- 次版本号（MINOR）：添加向下兼容的新功能时递增（新增功能或 API、新增配置选项、新增组件或工具函数、增强现有功能）
- 修订号（PATCH）：进行向下兼容的问题修正时递增（Bug 修复、性能优化、文档更新和修正、类型定义修正）

### 版本更新时机

- 发布到 npm 或其他包管理器前，必须更新版本号

## 代码变更规范

- 修改前检查：检查是否有其他代码依赖、相关测试需要更新、相关文档需要同步（必须使用 `read_file` 工具逐行逐字符读取相关文件，使用 `grep` 或 `codebase_search` 工具搜索引用）
- 保持向后兼容：避免破坏性变更，如果必须进行破坏性变更，明确标注并更新版本号
- 重构原则：小步重构，重构前确保有测试覆盖，重构后运行完整测试套件，保持功能不变
- 删除代码前检查：检查是否有其他地方引用、相关测试需要删除或更新、相关文档需要更新（必须使用 `read_file` 工具逐行逐字符读取相关文件，使用 `grep` 或 `codebase_search` 工具搜索引用）
- 公共 API 废弃策略：如果是公共 API，考虑废弃（deprecate）而不是直接删除

## 文件管理规范

- 创建新文件：遵循项目的目录结构和命名规范，添加必要的文件头注释（必须严格遵循 [`010_development-standards.mdc`](./010_development-standards.mdc)），检查是否需要更新入口文件和文档（必须使用 `read_file` 工具逐行逐字符读取相关文件，使用 `grep` 或 `codebase_search` 工具搜索引用）
- 删除文件前检查：检查是否有其他文件导入、是否需要更新导出文件、是否需要删除相关测试文件、是否需要更新相关文档（必须使用 `read_file` 工具逐行逐字符读取相关文件，使用 `grep` 或 `codebase_search` 工具搜索引用）
- 重命名文件：更新所有导入此文件的地方、更新导出文件、更新相关文档中的引用

## 代码审查规范

- 审查要点：代码是否符合项目规范、是否有潜在的安全问题、是否有性能问题、是否有测试覆盖、文档是否同步更新
- 反馈处理：认真对待审查反馈，及时修复审查中发现的问题，修复后重新提交审查

## 依赖管理规范

- 统一在 `package.json` 中声明所有依赖，严格区分 `dependencies` 和 `devDependencies`
- 如果使用第三方包，优先安装最新版本
- 生产依赖使用精确版本或版本范围锁定，开发依赖可使用 `^` 或 `~` 允许小版本更新
- 添加依赖前评估：评估依赖的必要性、安全性、维护状态和许可证兼容性
- 更新依赖前检查：查看更新日志，检查是否有破坏性变更，运行测试确保兼容性（必须使用 `read_file` 工具逐行逐字符读取相关文档和配置文件）
- 处理依赖冲突：优先使用项目已使用的版本，使用 `pnpm why` 或类似命令分析依赖树
