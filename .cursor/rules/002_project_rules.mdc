---
description: Element Plus Kit 项目特定开发规范
globs: 
alwaysApply: true
---

# Element Plus Kit 项目开发规范

## 项目架构概述

### Monorepo 结构
- **包管理工具**：pnpm workspace（参考 001 规范）
- **包结构**：
  - `packages/core`：核心工具函数包（无 Vue 组件）
  - `packages/form`：表单组件包（依赖 core）
  - `packages/kit`：主包，聚合所有组件和工具（依赖 form 和 core）
  - `playground`：本地开发测试环境
  - `docs`：VitePress 文档站点
- **技术栈**：Vue 3 + TypeScript + Vite + Element Plus
- **模块系统**：ES Module（`type: "module"`）

### 包依赖关系
```
core (独立包)
  ↓
form (依赖 core)
  ↓
kit (依赖 form 和 core)
```

---

## 开发环境配置

### Node.js 版本管理
- **必须使用 Volta 管理 Node.js 版本**（参考 000 规范）
- **当前版本**：Node.js 25.1.0（`package.json` 的 `volta.node`）
- **版本要求**：`^20.19.0 || >=22.12.0`（`package.json` 的 `engines`）

### 包管理器
- **必须使用 pnpm**：项目使用 pnpm workspace 管理 Monorepo（参考 001 规范）
- **工作区配置**：`pnpm-workspace.yaml` 定义工作区包（`packages/*`、`playground`、`docs`）

### 开发工具
- **代码规范**：ESLint（基于 @antfu/eslint-config，参考 000 规范）
- **构建工具**：Vite
- **Git Hooks**：Husky + lint-staged（参考 000 规范）
- **提交规范**：Commitlint（Conventional Commits，参考 000 规范）

---

## 包命名和导入规范

### 包命名规范
- **Scoped Package**：所有包使用 `@iswangh/element-plus-kit` 作用域
- **命名格式**：
  - `@iswangh/element-plus-kit-core`（core 包）
  - `@iswangh/element-plus-kit-form`（form 包）
  - `@iswangh/element-plus-kit`（主包，无后缀）

### 包导入规范
- **必须使用包名导入**：在代码中使用包名而不是相对路径
  ```typescript
  // ✅ 正确
  import { checkCondition } from '@iswangh/element-plus-kit-core'
  import { WForm } from '@iswangh/element-plus-kit-form'
  
  // ❌ 错误
  import { checkCondition } from '@/core'
  import { WForm } from '../../packages/form/src/index'
  ```
- **路径别名配置**：
  - 仅在 `tsconfig.app.json` 中配置，用于根目录类型解析
  - 在 `playground/vite.config.ts` 中配置，用于开发时直接引用源码，支持 HMR
  - 不在包内部使用路径别名，必须使用包名导入

---

## 包依赖管理

### 内部依赖
- **使用 `workspace:*` 协议**（参考 001 规范）：
  ```json
  {
    "dependencies": {
      "@iswangh/element-plus-kit-core": "workspace:*"
    }
  }
  ```

### 外部依赖
- **使用 `peerDependencies` 声明**（参考 001 规范）
- **版本要求**：
  - Vue: `^3.5.23`
  - Element Plus: `^2.11.7`
- **注意**：Element Plus 的全局配置应在使用 Element Plus Kit 的项目中处理，而不是在组件库包中

### 开发依赖
- **统一放在根目录的 `devDependencies`**（参考 001 规范）

---

## 包构建规范

### 构建命令
- **单个包**：`cd packages/core && pnpm build`
- **所有包**：`pnpm build:packages`（根目录，使用 filter 批量构建）
- **完整流程**：`pnpm build`（并行执行类型检查 + 构建所有包）

### 构建配置
- **构建工具**：Vite（库模式）
- **类型生成**：使用 `vite-plugin-dts` 自动生成类型声明文件
- **外部依赖**：所有 `peerDependencies` 和内部依赖都标记为 `external`
- **样式处理**：
  - form 包：样式文件统一输出为 `style.css`（`cssCodeSplit: false`）
  - 通过 `package.json` 的 `exports` 字段导出样式文件

### 构建产物
- **输出目录**：`packages/*/dist/`（已在 `.gitignore` 中排除，参考 001 规范）
- **包含文件**：`.js`、`.d.ts`、`.d.ts.map`
- **样式文件**：`packages/form/dist/style.css`
- **多入口支持**：kit 包支持多入口（`index` 和 `resolver`）

### 构建前检查
- **发布前自动执行 `prepublishOnly`**（构建 + 类型检查）

---

## TypeScript 配置规范

### 项目引用
- **使用 TypeScript Project References** 管理包之间的类型依赖（参考 001 规范）
- **配置继承**：
  - 根目录：`tsconfig.app.json`（基础配置，包含路径别名）
  - 各包：继承 `tsconfig.app.json`，启用 `composite: true`
  - Playground：继承 `tsconfig.app.json`，不启用 `composite`

### 类型定义
- **通过 `package.json` 的 `exports.types` 字段导出**（参考 001 规范）
- **构建时自动生成**（使用 `vite-plugin-dts`）
- **类型文件位置**：`dist/` 目录
- **路径别名**：仅在根目录 `tsconfig.app.json` 中配置，用于类型解析

---

## 代码开发规范

### Vue 组件规范
- **单文件组件**：必须使用 `<script setup lang="ts">`（参考 000 规范）
- **组件前缀**：所有组件以 `W` 开头（如 `WForm`、`w-form`）
- **组件命名**：使用 PascalCase（如 `WForm`、`FormItem`）

### TypeScript 类型规范
- **类型推断优先**：充分利用类型推断，避免不必要的类型注解（参考 000 规范）
- **类型导出**：在包的 `src/types.ts` 或 `src/index.ts` 中统一导出类型
- **类型命名**：使用 PascalCase（如 `FormItems`、`FormConfig`）
- **接口优先**：优先使用 `interface` 定义对象类型（参考 000 规范）

### 文件组织规范
- **包目录结构**：遵循 Monorepo 通用规范（参考 001 规范）
- **模块入口**：每个模块必须有 `index.ts` 作为聚合导出入口（参考 000 规范）
- **文件命名**：
  - TypeScript 文件：`camelCase.ts`
  - Vue 组件：`PascalCase.vue`
  - 配置文件：`kebab-case.config.ts`

### 导出规范
- **统一导出**：通过 `src/index.ts` 统一导出所有公共 API（参考 000 规范）
- **类型导出**：类型和值分开导出，使用 `export type` 导出类型（参考 000 规范）

---

## 构建和发布规范

### 构建流程
- **开发时构建**：
  - 单个包监听模式：`cd packages/core && pnpm dev`
  - 所有包构建：`pnpm build:packages`（使用 filter 批量构建）
  - 完整开发环境：`pnpm dev`（并行运行包的 watch 模式和 playground）
- **生产构建**：`pnpm build`（并行执行类型检查 + 构建所有包）
- **类型检查**：`pnpm type-check`（使用 `vue-tsc --build`）

### 发布流程
- **发布顺序**：必须按照依赖顺序发布（core → form → kit）（参考 001 规范）
- **发布命令**：
  - 单个包：`pnpm publish:core`、`pnpm publish:form`、`pnpm publish:kit`
  - 所有包：`pnpm publish:all`（使用 `run-s` 串行执行）
  - 分支检查：`pnpm check:branch`（单独检查分支）
- **发布前检查**：
  - **分支检查**：自动检查当前 Git 分支，只能在 `main` 或 `master` 分支上发布（通过 `scripts/check-branch.js` 脚本）
  - 自动执行 `prepublishOnly`（构建 + 类型检查）
  - 确保版本号已更新
  - 确保依赖版本已更新（如果被依赖包版本变化）
- **分支检查机制**：
  - 每个发布命令（`publish:core`、`publish:form`、`publish:kit`）都会在执行前自动检查分支
  - 如果当前分支不是 `main` 或 `master`，发布会被阻止并提示错误
  - 分支检查脚本：`scripts/check-branch.js`

### 版本管理
- **版本策略**：独立版本（每个包独立管理版本号）（参考 001 规范）
- **版本格式**：遵循语义化版本（SemVer）（参考 000 规范）
- **版本更新**：使用 `npm version patch/minor/major` 更新版本

---

## 代码质量规范

### ESLint 规则
- **基础配置**：基于 @antfu/eslint-config（参考 000 规范）
- **项目特定规则**：
  - 允许使用箭头函数声明顶级函数（`antfu/top-level-function: 'off'`）
  - Vue 组件必须使用 `<script setup lang="ts">`（`vue/block-lang`）
  - 检测未使用的导入和变量（`unused-imports`）
- **命令**：`pnpm lint`（检查）、`pnpm lint:fix`（修复）、`pnpm eslint:inspect`（查看配置）

### Git 提交规范
- **提交格式**：遵循 Conventional Commits 规范（参考 000 规范）
- **作用域（scope）**：建议使用包名（如 `core`、`form`、`kit`）

---

## 文档规范

### 包文档
- **README.md**：每个包必须包含 README.md，说明包的功能、安装使用方法、API 文档链接和示例代码

### 代码注释
- **JSDoc 标准**：所有公共 API 必须使用 JSDoc 注释（参考 000 规范）

---

## 测试规范

### 测试框架
- **测试框架**：Vitest（已配置但未使用）
- **测试文件组织**：与源文件同目录或 `__tests__` 目录，命名 `*.test.ts` 或 `*.spec.ts`（参考 000 规范）
- **测试要求**：核心功能必须有单元测试，Vue 组件使用 @vue/test-utils 进行测试（参考 000 规范）

---

## 性能优化规范

### 构建优化
- **代码分割**：按需导入，避免全量导入（参考 000 规范）
- **Tree Shaking**：确保构建工具能够正确进行 Tree Shaking（参考 001 规范）
- **外部依赖**：使用 `external` 配置，避免打包外部依赖（参考 001 规范）

### 运行时优化
- **按需导入**：组件库支持按需导入
- **自动导入**：支持通过 `unplugin-vue-components` 和 `unplugin-auto-import` 自动导入（详见"自动导入配置"章节）

---

## 开发工作流规范

### 根目录脚本配置
- **多包脚本管理**：在项目根目录的 `package.json` 中添加运行或打包多个包的脚本（参考 001 规范）
- **脚本工具**：使用 `npm-run-all` 和 pnpm filter 功能混用（参考 001 规范）
- **脚本示例**：
  ```json
  {
    "scripts": {
      "dev": "run-p \"dev:packages\" \"dev:playground\"",
      "dev:packages": "pnpm --filter \"./packages/*\" dev",
      "build:packages": "pnpm --filter \"./packages/*\" build",
      "publish:all": "run-s publish:core publish:form publish:kit"
    }
  }
  ```

### 开发环境
- **本地开发**：使用 watch 模式自动构建，通过路径别名直接引用源码支持 HMR，使用 `pnpm dev` 并行启动包的 watch 模式和 playground
- **测试环境**：使用 playground 进行功能测试，确保测试环境与实际使用环境一致
- **热更新**：通过路径别名直接引用源码支持 HMR，配置在 `playground/vite.config.ts` 中，确保开发时使用源码，生产构建时使用构建产物

### 自动导入配置
- **Vue API 自动导入**：使用 `unplugin-auto-import` 自动导入 Vue API（ref、computed 等）
- **组件自动导入**：使用 `unplugin-vue-components` 自动导入 Element Plus 和 Element Plus Kit 组件
- **解析器**：kit 包提供 `ElementPlusKitResolver` 用于自动导入解析
- **类型声明**：自动生成类型声明文件（`types/auto-imports.d.ts`、`types/components.d.ts`）

---

## 工具和命令

- **查看命令**：直接查看项目根目录和各包的 `package.json` 文件中的 `scripts` 字段获取可用命令
